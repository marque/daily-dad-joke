<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Daily Dad Jokes</title>
    <style>
      :root {
        /* Change these two to tweak the background */
        --bg-a: #1f2a6d;
        --bg-b: #21b6a8;

        --card: rgba(245, 247, 255, 0.92);
        --ink: #273046;
        --muted: rgba(39, 48, 70, 0.72);
        --shadow: 0 18px 50px rgba(0,0,0,0.20);
        --radius: 34px;
      }

      * { box-sizing: border-box; }
      body {
        margin: 0;
        min-height: 100vh;
        font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
        color: var(--ink);
        background:
          radial-gradient(1200px 700px at 15% 10%, rgba(255,255,255,0.22), transparent 55%),
          radial-gradient(900px 600px at 85% 15%, rgba(255,255,255,0.14), transparent 50%),
          linear-gradient(135deg, var(--bg-a), var(--bg-b));
        display: grid;
        place-items: center;
        padding: 26px 14px;
      }

      .shell {
        width: min(720px, 100%);
      }

      .panel {
        background: var(--card);
        border-radius: var(--radius);
        box-shadow: var(--shadow);
        padding: 34px 26px 22px;
        backdrop-filter: blur(10px);
      }

      h1 {
        margin: 6px 0 18px;
        text-align: center;
        font-size: clamp(2rem, 3.8vw, 3.2rem);
        letter-spacing: -0.02em;
      }

      .imgWrap {
        display: grid;
        place-items: center;
        padding: 14px;
        border-radius: 26px;
        background: rgba(255,255,255,0.55);
        margin: 0 auto 18px;
        width: min(520px, 100%);
        aspect-ratio: 1 / 1;
      }

      .imgWrap img { width: 100%; height: 100%; object-fit: cover; border-radius: 18px; }

      .jokeCard {
        margin: 16px auto 18px;
        width: 100%;
        background: rgba(255,255,255,0.88);
        border-radius: 26px;
        padding: 26px 20px;
        box-shadow: 0 10px 24px rgba(0,0,0,0.12);
      }

      #joke {
        font-size: clamp(1.25rem, 2.3vw, 1.7rem);
        line-height: 1.45;
        text-align: center;
        font-weight: 650;
      }

      .divider {
        height: 1px;
        background: rgba(39,48,70,0.16);
        margin: 18px 0 16px;
      }

      .meta {
        text-align: center;
        display: grid;
        gap: 10px;
        color: var(--muted);
        font-weight: 600;
      }

      .meta .big {
        font-size: 1.15rem;
        color: rgba(39,48,70,0.72);
        font-weight: 750;
      }

      .buttons {
        margin-top: 18px;
        display: flex;
        gap: 12px;
        justify-content: center;
        flex-wrap: wrap;
      }

      .btn {
        border: none;
        border-radius: 999px;
        padding: 14px 22px;
        font-weight: 800;
        font-size: 1.05rem;
        color: white;
        background: rgba(70, 120, 255, 0.78);
        box-shadow: 0 10px 18px rgba(39,48,70,0.18);
        cursor: pointer;
      }
      .btn:hover { filter: brightness(1.05); }

      .hint { text-align: center; margin-top: 12px; font-size: .95rem; color: rgba(255,255,255,0.85); }
      .hint a { color: rgba(255,255,255,0.92); }
    </style>
  </head>
  <body>
    <div class="shell">
      <div class="panel">
        <h1>Daily Dad Jokes</h1>

        <div class="imgWrap">
          <picture style="width:100%;height:100%">
            <source id="imgPng" type="image/png" />
            <img id="img" alt="Daily dad joke image" />
          </picture>
        </div>

        <div class="jokeCard">
          <div id="joke">Loading‚Ä¶</div>
        </div>

        <div class="divider"></div>

        <div class="meta">
          <div id="count">üìä 0 jokes and counting!</div>
          <div class="big" id="date">üìÖ</div>
          <!-- source hidden -->
        </div>

        <div class="buttons">
          <button class="btn" id="btnToday">Today</button>
          <button class="btn" id="btnPrev">‚Üê Previous Day</button>
          <button class="btn" id="btnLucky">üçÄ Lucky Day</button>
        </div>
      </div>

      <div class="hint">Tip: If something looks stale, hard refresh (Ctrl/Cmd+Shift+R).</div>
    </div>

    <script>
      const DATA_URL = "joke-of-the-day.json";
      const IMG_URL = "image-of-the-day.svg";

      function formatDateEt(yyyyMmDd) {
        // Display in America/Toronto, like the screenshot style
        const [y, m, d] = yyyyMmDd.split('-').map(Number);
        const dt = new Date(Date.UTC(y, m - 1, d, 12, 0, 0));
        return new Intl.DateTimeFormat('en-US', {
          weekday: 'long', year: 'numeric', month: 'long', day: 'numeric',
          timeZone: 'America/Toronto'
        }).format(dt) + ' (ET)';
      }

      async function loadToday() {
        const res = await fetch(DATA_URL, { cache: 'no-store' });
        if (!res.ok) throw new Error(`HTTP ${res.status}`);
        const data = await res.json();

        document.getElementById("imgPng").srcset = "image-of-the-day.png?v=" + encodeURIComponent(data.date);
        document.getElementById("img").src = IMG_URL + "?v=" + encodeURIComponent(data.date);

        document.getElementById('joke').textContent = data.joke;
        document.getElementById('date').textContent = 'üìÖ ' + formatDateEt(data.date);
        // source hidden

        // crude count for now = lines in jokes.txt baked at build time (not available in browser)
        document.getElementById('count').textContent = 'üìä 5 jokes and counting!';

        return data;
      }

      function addDays(dateStr, delta) {
        const [y, m, d] = dateStr.split('-').map(Number);
        const dt = new Date(Date.UTC(y, m - 1, d, 12, 0, 0));
        dt.setUTCDate(dt.getUTCDate() + delta);
        return dt.toISOString().slice(0, 10);
      }

      async function loadByDate(date) {
        // Loads from repo-served archive so it works on GitHub Pages
        const res = await fetch(`archive/${date}.json`, { cache: 'no-store' });
        if (!res.ok) throw new Error(`No archive for ${date} (HTTP ${res.status})`);
        const data = await res.json();

        // Square display: just use the PNG
        document.getElementById("imgPng").srcset = `archive/${date}.png?v=${encodeURIComponent(date)}`;
        document.getElementById("img").src = `archive/${date}.png?v=${encodeURIComponent(date)}`;

        document.getElementById('joke').textContent = data.joke;
        document.getElementById('date').textContent = 'üìÖ ' + formatDateEt(data.date);
        return data;
      }

      (async () => {
        try {
          let current = (await loadToday()).date;

          document.getElementById('btnToday').onclick = async () => {
            current = (await loadToday()).date;
          };

          document.getElementById('btnPrev').onclick = async () => {
            try {
              const prev = addDays(current, -1);
              current = (await loadByDate(prev)).date;
            } catch (e) {
              alert(String(e));
            }
          };

          document.getElementById('btnLucky').onclick = async () => {
            // Try random dates from the last 30 days until we find one that exists.
            for (let tries = 0; tries < 12; tries++) {
              const offset = -1 * (1 + Math.floor(Math.random() * 30));
              const candidate = addDays(current, offset);
              try {
                current = (await loadByDate(candidate)).date;
                return;
              } catch {}
            }
            alert('No archived days found yet.');
          };
        } catch (e) {
          document.getElementById('joke').textContent = "Couldn't load today's joke.";
          document.getElementById('date').textContent = String(e);
        }
      })();
    </script>
  </body>
</html>
